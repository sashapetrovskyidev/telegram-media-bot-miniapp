<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Studio Quest</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
    // --- ПЕРВАЯ КОМНАТА (ГОСТИНАЯ) ---
    class MainScene extends Phaser.Scene {
        constructor() { super('MainScene'); }

        preload() {
            // Относительные пути для GitHub Pages
            this.load.image('room1', 'room1.png'); 
            this.load.image('player', 'player.png');
            
            this.load.on('loaderror', (file) => {
                console.error('Ошибка загрузки файла: ' + file.key);
            });
        }

        create() {
            // Фон (центр экрана 540, 960 при разрешении 1080x1920)
            this.add.image(540, 960, 'room1').setDisplaySize(1080, 1920);

            // Персонаж
            this.player = this.physics.add.sprite(540, 1500, 'player').setScale(0.8);
            this.player.setCollideWorldBounds(true);

            // Управление тапом (куда нажал - туда и пошел)
            this.input.on('pointerdown', (pointer) => {
                this.physics.moveToObject(this.player, pointer, 400);
            });

            // Зона перехода в студию (невидимый прямоугольник справа)
            this.exitZone = this.add.rectangle(1050, 960, 100, 1920, 0xff0000, 0);
            this.physics.add.existing(this.exitZone, true);

            this.physics.add.overlap(this.player, this.exitZone, () => {
                this.scene.start('StudioScene');
            });

            // --- КОЛЛИЗИИ (СТЕНЫ И МЕБЕЛЬ) ---
            // Пример: невидимая стена для дивана, чтобы не ходить сквозь него
            let sofaObstacle = this.add.rectangle(540, 1400, 600, 200, 0x000000, 0);
            this.physics.add.existing(sofaObstacle, true);
            this.physics.add.collider(this.player, sofaObstacle);
        }

        update() {
            // Остановка персонажа в точке нажатия
            let distance = Phaser.Math.Distance.Between(
                this.player.x, 
                this.player.y, 
                this.input.activePointer.worldX, 
                this.input.activePointer.worldY
            );

            if (this.player.body.speed > 0 && distance < 15) {
                this.player.body.reset(this.player.x, this.player.y);
            }
        }
    }

    // --- ВТОРАЯ КОМНАТА (СТУДИЯ) ---
    class StudioScene extends Phaser.Scene {
        constructor() { super('StudioScene'); }

        preload() {
            this.load.image('room2', 'room2.png');
        }

        create() {
            this.add.image(540, 960, 'room2').setDisplaySize(1080, 1920);
            
            // Появляемся слева (как будто зашли из гостиной)
            this.player = this.physics.add.sprite(100, 960, 'player').setScale(0.8);
            this.player.setCollideWorldBounds(true);
            
            this.input.on('pointerdown', (pointer) => {
                this.physics.moveToObject(this.player, pointer, 400);
            });

            // Зона возврата в гостиную (невидимый прямоугольник слева)
            this.backZone = this.add.rectangle(30, 960, 100, 1920, 0xff0000, 0);
            this.physics.add.existing(this.backZone, true);

            this.physics.add.overlap(this.player, this.backZone, () => {
                this.scene.start('MainScene');
            });
        }

        update() {
            let distance = Phaser.Math.Distance.Between(
                this.player.x, 
                this.player.y, 
                this.input.activePointer.worldX, 
                this.input.activePointer.worldY
            );

            if (this.player.body.speed > 0 && distance < 15) {
                this.player.body.reset(this.player.x, this.player.y);
            }
        }
    }

    // --- ИНИЦИАЛИЗАЦИЯ ИГРЫ (После объявления всех классов) ---
    const config = {
        type: Phaser.AUTO,
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 1080,
            height: 1920
        },
        physics: {
            default: 'arcade',
            arcade: { 
                debug: false // Измени на true, если хочешь видеть границы стен и зон перехода
            }
        },
        scene: [MainScene, StudioScene]
    };

    const game = new Phaser.Game(config);
</script>
</body>
</html>
