<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Studio Quest</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
    // --- START MENU SCENE ---
    class MenuScene extends Phaser.Scene {
        constructor() { super('MenuScene'); }

        preload() {
            // Можно добавить логотип или фоновое изображение для меню
            // this.load.image('menuBg', 'menu_bg.jpg');
        }

        create() {
            const { width, height } = this.scale;

            // Градиентный фон (создаем текстуру программно для легковесности)
            const graphics = this.add.graphics();
            graphics.fillGradientStyle(0x1a1a2e, 0x1a1a2e, 0x16213e, 0x16213e, 1);
            graphics.fillRect(0, 0, width, height);

            // Заголовок игры
            const title = this.add.text(width / 2, height / 3, 'STUDIO QUEST', {
                fontSize: '72px',
                fontFamily: 'Arial Black',
                color: '#00d9ff',
                stroke: '#0a4d68',
                strokeThickness: 8,
                shadow: {
                    offsetX: 4,
                    offsetY: 4,
                    color: '#000',
                    blur: 10,
                    fill: true
                }
            }).setOrigin(0.5);

            // Анимация заголовка
            this.tweens.add({
                targets: title,
                scale: { from: 0.9, to: 1.1 },
                duration: 1500,
                yoyo: true,
                repeat: -1,
                ease: 'Sine.easeInOut'
            });

            // Кнопка "Начать игру"
            const buttonY = height / 2 + 100;
            const button = this.add.rectangle(width / 2, buttonY, 400, 100, 0x00d9ff, 1)
                .setStrokeStyle(4, 0xffffff)
                .setInteractive({ useHandCursor: true });

            const buttonText = this.add.text(width / 2, buttonY, 'НАЧАТЬ ИГРУ', {
                fontSize: '42px',
                fontFamily: 'Arial',
                color: '#000',
                fontStyle: 'bold'
            }).setOrigin(0.5);

            // Эффекты при наведении/нажатии
            button.on('pointerover', () => {
                button.setFillStyle(0x00fff2);
                this.tweens.add({
                    targets: button,
                    scale: 1.1,
                    duration: 200
                });
            });

            button.on('pointerout', () => {
                button.setFillStyle(0x00d9ff);
                this.tweens.add({
                    targets: button,
                    scale: 1.0,
                    duration: 200
                });
            });

            button.on('pointerdown', () => {
                // Эффект нажатия
                this.tweens.add({
                    targets: [button, buttonText],
                    scale: 0.95,
                    duration: 100,
                    yoyo: true,
                    onComplete: () => {
                        // Плавный переход к игре
                        this.cameras.main.fadeOut(500, 0, 0, 0);
                        this.time.delayedCall(500, () => {
                            this.scene.start('MainScene');
                        });
                    }
                });
            });

            // Инструкция
            this.add.text(width / 2, height - 150, 'Нажмите на экран, чтобы двигаться', {
                fontSize: '28px',
                fontFamily: 'Arial',
                color: '#ffffff',
                alpha: 0.7
            }).setOrigin(0.5);

            // Появление меню
            this.cameras.main.fadeIn(1000, 0, 0, 0);
        }
    }

    // --- ПЕРВАЯ КОМНАТА (ГОСТИНАЯ) ---
    class MainScene extends Phaser.Scene {
        constructor() { super('MainScene'); }

        preload() {
            this.load.image('room1', 'room1.jpg'); 
            this.load.image('player', 'player.png');
            
            this.load.on('loaderror', (file) => {
                console.error('Ошибка загрузки файла: ' + file.key);
            });
        }

        create() {
            // Фон комнаты (теперь это будет игровой мир)
            const bg = this.add.image(0, 0, 'room1').setOrigin(0, 0);
            
            // Получаем размеры фона для установки границ мира
            const bgWidth = bg.width;
            const bgHeight = bg.height;
            
            // Устанавливаем границы мира по размеру фона
            this.physics.world.setBounds(0, 0, bgWidth, bgHeight);

            // Персонаж появляется в центре комнаты
            this.player = this.physics.add.sprite(bgWidth / 2, bgHeight / 2, 'player').setScale(0.8);
            this.player.setCollideWorldBounds(true);

            // КАМЕРА СЛЕДУЕТ ЗА ИГРОКОМ
            this.cameras.main.startFollow(this.player, true, 0.1, 0.1);
            this.cameras.main.setBounds(0, 0, bgWidth, bgHeight);
            
            // Плавное появление сцены
            this.cameras.main.fadeIn(1000, 0, 0, 0);

            // Управление тапом
            this.input.on('pointerdown', (pointer) => {
                // Конвертируем координаты экрана в мировые координаты
                const worldPoint = this.cameras.main.getWorldPoint(pointer.x, pointer.y);
                this.physics.moveToObject(this.player, worldPoint, 300);
            });

            // Зона перехода в студию (справа, вдоль всей высоты)
            this.exitZone = this.add.rectangle(bgWidth - 50, bgHeight / 2, 100, bgHeight, 0xff0000, 0);
            this.physics.add.existing(this.exitZone, true);

            this.physics.add.overlap(this.player, this.exitZone, () => {
                this.cameras.main.fadeOut(500, 0, 0, 0);
                this.time.delayedCall(500, () => {
                    this.scene.start('StudioScene');
                });
            });

            // --- КОЛЛИЗИИ (СТЕНЫ И МЕБЕЛЬ) ---
            // Пример препятствий (настрой под свою комнату)
            this.obstacles = this.physics.add.staticGroup();
            
            // Пример: диван в центре-снизу
            // let sofa = this.obstacles.create(bgWidth / 2, bgHeight - 300, null)
            //     .setSize(600, 200).setVisible(false);
            
            // this.physics.add.collider(this.player, this.obstacles);
        }

        update() {
            // Останавливаем персонажа, когда он достигает цели
            if (this.player.body.speed > 0) {
                const distance = Phaser.Math.Distance.Between(
                    this.player.x, 
                    this.player.y, 
                    this.player.body.velocity.x + this.player.x,
                    this.player.body.velocity.y + this.player.y
                );

                // Если персонаж почти на месте, останавливаем
                if (Math.abs(this.player.body.velocity.x) < 10 && 
                    Math.abs(this.player.body.velocity.y) < 10) {
                    this.player.body.setVelocity(0);
                }
            }
        }
    }

    // --- ВТОРАЯ КОМНАТА (СТУДИЯ) - С ПОДДЕРЖКОЙ ДВУХ ЧАСТЕЙ ---
    class StudioScene extends Phaser.Scene {
        constructor() { super('StudioScene'); }

        preload() {
            // Загружаем две части студии
            this.load.image('room2_part1', 'room2_part1.jpg');
            this.load.image('room2_part2', 'room2_part2.jpg');
            // Если одна картинка: this.load.image('room2', 'room2.jpg');
        }

        create() {
            // Вариант 1: Если у тебя две части комнаты (верх и низ или лево и право)
            // Расположи их рядом друг с другом
            const part1 = this.add.image(0, 0, 'room2_part1').setOrigin(0, 0);
            const part2 = this.add.image(0, part1.height, 'room2_part2').setOrigin(0, 0);
            
            const worldWidth = Math.max(part1.width, part2.width);
            const worldHeight = part1.height + part2.height;

            // Если части горизонтально:
            // const part1 = this.add.image(0, 0, 'room2_part1').setOrigin(0, 0);
            // const part2 = this.add.image(part1.width, 0, 'room2_part2').setOrigin(0, 0);
            // const worldWidth = part1.width + part2.width;
            // const worldHeight = Math.max(part1.height, part2.height);

            this.physics.world.setBounds(0, 0, worldWidth, worldHeight);

            // Персонаж появляется слева (как будто зашел из гостиной)
            this.player = this.physics.add.sprite(200, 200, 'player').setScale(0.8);
            this.player.setCollideWorldBounds(true);
            
            // КАМЕРА СЛЕДУЕТ ЗА ИГРОКОМ
            this.cameras.main.startFollow(this.player, true, 0.1, 0.1);
            this.cameras.main.setBounds(0, 0, worldWidth, worldHeight);
            
            // Плавное появление
            this.cameras.main.fadeIn(1000, 0, 0, 0);
            
            this.input.on('pointerdown', (pointer) => {
                const worldPoint = this.cameras.main.getWorldPoint(pointer.x, pointer.y);
                this.physics.moveToObject(this.player, worldPoint, 300);
            });

            // Зона возврата в гостиную (слева)
            this.backZone = this.add.rectangle(50, worldHeight / 2, 100, worldHeight, 0xff0000, 0);
            this.physics.add.existing(this.backZone, true);

            this.physics.add.overlap(this.player, this.backZone, () => {
                this.cameras.main.fadeOut(500, 0, 0, 0);
                this.time.delayedCall(500, () => {
                    this.scene.start('MainScene');
                });
            });

            // Можно добавить препятствия для студии
            // this.obstacles = this.physics.add.staticGroup();
            // this.physics.add.collider(this.player, this.obstacles);
        }

        update() {
            if (this.player.body.speed > 0) {
                if (Math.abs(this.player.body.velocity.x) < 10 && 
                    Math.abs(this.player.body.velocity.y) < 10) {
                    this.player.body.setVelocity(0);
                }
            }
        }
    }

    // --- ИНИЦИАЛИЗАЦИЯ ИГРЫ ---
    const config = {
        type: Phaser.AUTO,
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 1080,
            height: 1920
        },
        physics: {
            default: 'arcade',
            arcade: { 
                debug: false // Поставь true для отладки коллизий
            }
        },
        scene: [MenuScene, MainScene, StudioScene] // MenuScene стартует первой
    };

    const game = new Phaser.Game(config);
</script>
</body>
</html>
